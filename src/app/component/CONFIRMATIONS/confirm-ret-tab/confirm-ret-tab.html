
  
  <!-- Retention page -->
  <div class="">
    <div *ngIf="loadingSectionA; else sectionAContent" class="spinner-container">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
      <ng-template #sectionAContent>
      <div class="card shadow rounded bg-light mx-auto mb-5">
        <div class="card-body p-3">
          <div class="table-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div class="filter-field flex-grow-1">
                <input type="text" class="form-control form-control-sm" placeholder="Filter"
                  (keyup)="applyTextFilterRet($event)" />
              </div>
              <div class="export-menu-container ms-2">
                <!-- <button type="button" class="btn border rounded text-light" mat-button style="background-color: rgb(21, 184, 0);"(click)="onshowButtonClick()"
                >Add <i class="bi bi-folder-plus"></i></button> -->
                <!-- <button mat-button [matMenuTriggerFor]="exportMenuRet" class="btn btn-sm btn-secondary">
                  Export
                </button>
                <mat-menu #exportMenuRet="matMenu">
                  <button mat-menu-item (click)="exporter.exportTable('xlsx', {
                  fileName: 'RetentionList',
                  sheet: 'RetentionList',
                  Props: { Author: 'cgmsc' }
                })">
                    Excel
                  </button>
                  <button mat-menu-item (click)="exportToPDFRetention()">PDF</button>
                </mat-menu> -->
              </div>
            </div>
  
            <div class="table-responsive">
              <table mat-table [dataSource]="dataSource3" matTableExporter
                class="table table-bordered table-hover table-sm align-middle" #exporter="matTableExporter" matSort
                #sort3="matSort">
                  <!-- S.No -->
      <ng-container matColumnDef="sno">
        <th mat-header-cell *matHeaderCellDef style="width: 60px;">S.No</th>
        <td mat-cell *matCellDef="let row; let i = index">{{ i + 1 }}</td>
      </ng-container>
  
      <!-- Licence No -->
      <ng-container matColumnDef="licno">
        <th mat-header-cell *matHeaderCellDef>Licence No</th>
        <td mat-cell *matCellDef="let row">{{ row.licno }}</td>
      </ng-container>
  
      <!-- Unit Name -->
      <ng-container matColumnDef="unitname">
        <th mat-header-cell *matHeaderCellDef>Unit Name</th>
        <td mat-cell *matCellDef="let row">{{ row.unitname }}</td>
      </ng-container>
  
      <!-- Issue Date -->
      <ng-container matColumnDef="issuedate">
        <th mat-header-cell *matHeaderCellDef>Issue Date</th>
        <td mat-cell *matCellDef="let row">{{ row.issuedate }}</td>
      </ng-container>
  
      <!-- Start Date -->
      <ng-container matColumnDef="startdate">
        <th mat-header-cell *matHeaderCellDef>Start Date</th>
        <td mat-cell *matCellDef="let row">{{ row.startdate }}</td>
      </ng-container>
  
      <!-- Expiry Date -->
      <ng-container matColumnDef="expdate">
        <th mat-header-cell *matHeaderCellDef>Expiry Date</th>
        <td mat-cell *matCellDef="let row">{{ row.expdate }}</td>
      </ng-container>
  
      <!-- Retention Name -->
      <ng-container matColumnDef="retname">
        <th mat-header-cell *matHeaderCellDef>Retention</th>
        <td mat-cell *matCellDef="let row">{{ row.retname }}</td>
      </ng-container> 
      <ng-container matColumnDef="proIssuingAuthority">
        <th mat-header-cell *matHeaderCellDef>Issuing Authority</th>
        <td mat-cell *matCellDef="let row">{{ row.proIssuingAuthority }}</td>
      </ng-container>
  
      <!-- Form Name -->
      <ng-container matColumnDef="formname">
        <th mat-header-cell *matHeaderCellDef>Form Name</th>
        <td mat-cell *matCellDef="let row">{{ row.formname }}</td>
      </ng-container>
  
      <!-- Licence Type -->
      <ng-container matColumnDef="lictypename">
        <th mat-header-cell *matHeaderCellDef>Licence Type</th>
        <td mat-cell *matCellDef="let row">{{ row.lictypename }}</td>
      </ng-container>
  
      <!-- File Name -->
      <ng-container matColumnDef="filename">
        <th mat-header-cell *matHeaderCellDef>File</th>
        <td mat-cell *matCellDef="let row">
          <button 
            *ngIf="row.filename"
            class="btn btn-sm text-light align-items-center border rounded  btn-outline-danger-subtle bg-danger-subtle"
            (click)="DownloadFileWithName(row.filepath,row.filename)"
          >
          <i
          class="bi bi-filetype-pdf text-danger"></i>
          </button>
        </td>
      </ng-container>

      <ng-container matColumnDef="isplaccepted">
        <th mat-header-cell *matHeaderCellDef>Accepted</th>
      
        <td mat-cell *matCellDef="let row">
      
          <span 
            [ngClass]="{
              'text-success fw-bold': row.isplaccepted === 'Y',
              'text-danger fw-bold': row.isplaccepted === 'N',
              'text-secondary': row.isplaccepted === 'NA'
            }"
          >
            {{ row.isplaccepted === 'Y' ? 'YES' : row.isplaccepted === 'N' ? 'NO' : 'NA' }}
          </span>
      
        </td>
      </ng-container>
      
    
    <ng-container matColumnDef="placcrejremarks">
      <th mat-header-cell *matHeaderCellDef>Remarks</th>
      <td mat-cell *matCellDef="let row">{{ row.placcrejremarks }}</td>
    </ng-container>
    
    <ng-container matColumnDef="isplaccepteddt">
      <th mat-header-cell *matHeaderCellDef>Accepted Date</th>
      <td mat-cell *matCellDef="let row">{{ row.isplaccepteddt }}</td>
    </ng-container>


      <!-- APPROVED COLUMN -->
<ng-container matColumnDef="action">
    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 200px;">
      Approved
    </th>
  
    <td mat-cell *matCellDef="let element" class="text-center p-0">
  
        <div class="d-flex justify-content-center align-items-center gap-4">
             <!-- YES --> 
             
             <div class="form-check form-check-inline p-0 m-0">
          <input class="form-check-input small-radio"
                 type="radio"
                 name="approve{{element.licid}}"
                 [value]="'Y'"
                 (change)="setApproval(element, 'Y')">
          <label class="form-check-label tiny-text">YES</label>
        </div>
  
        <!-- NO -->
        <div class="form-check form-check-inline p-0 m-0">
          <input class="form-check-input small-radio"
                 type="radio"
                 name="approve{{element.licid}}"
                 [value]="'N'"
                 
                 (change)="setApproval(element, 'N')">
          <label class="form-check-label tiny-text">NO</label>
        </div>
  
      </div>
  
    </td>
  </ng-container>
  
  
  <!-- REMARK COLUMN -->
 <!-- REMARK INPUT -->
 <ng-container matColumnDef="Remark">
    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 200px;">
      Remark
    </th>
  
    <td mat-cell *matCellDef="let element" class="text-center p-0">
  
      <textarea
        class="form-control form-control-sm small-input mx-auto"
        placeholder="Enter remark"
        rows="2"
        style=" max-width: 160px;"
        [(ngModel)]="element.remark">
      </textarea>
  
    </td>
  </ng-container>
  
  
  <!-- SAVE BUTTON -->
  <ng-container matColumnDef="Save">
    <th mat-header-cell *matHeaderCellDef mat-sort-header style="width: 80px;">
      Action
    </th>
  
    <td mat-cell *matCellDef="let element" class="text-center p-0">
      <button class="btn btn-outline-primary btn-sm py-0 px-2"
              (click)="saveRow(element)">
        Save
      </button>
    </td>
  </ng-container>
  
  
                <!-- Header & Row Definition -->
                <tr mat-header-row *matHeaderRowDef="[
                'sno',
    'licno',
    'unitname',
    'issuedate',
    'startdate',
    'expdate',
    'retname',
    'proIssuingAuthority',
    'formname',
    'lictypename',
    'filename',
    'isplaccepted',
    'isplaccepteddt',
    'placcrejremarks',
  
              ]"></tr>
  
                <tr mat-row *matRowDef="let row; columns: [
                'sno',
    'licno',
    'unitname',
    'issuedate',
    'startdate',
    'expdate',
    'retname',
    'proIssuingAuthority',
    'formname',
    'lictypename',
    'filename',
    'isplaccepted',
    'isplaccepteddt',
    'placcrejremarks',
   
              ]"></tr>
              </table>
            </div>
            <mat-paginator #paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
          </div>
        </div>
      </div>
    </ng-template>
  
      <div class="card shadow-lg  border bg-whitee rounded " *ngIf="onshowRETE==true">
        
        <div class="card-body  px-3 py-3  pb-3 bg-light"
          style="height: auto; overflow: hidden; position: relative;">
          <div class="mb-3 Fon-family" style="text-align: justify;">
      <form [formGroup]="retForm" (ngSubmit)="onSubmitRetention()">
        <div class="row text-start ">
          <!-- Unit -->
          <div class="col-md-6 mb-3">
            <label class="form-label fw-bold">Licence<span class="text-danger">*</span></label>
            <div class="form-group" style="position: relative;">
            <ng-select class="form-select w-auto" [items]="ManLicDdllist" bindLabel="manfacname" bindValue="licid"
              formControlName="mLICID" [placeholder]="retForm.get('mLICID')?.value ? '' : 'Select Licence'"
              [searchable]="true" [clearable]="true" appendTo=".form-group" [ngStyle]="{
                'border': (retForm.get('mLICID')?.invalid && (retForm.get('mLICID')?.dirty || retForm.get('mLICID')?.touched))
                  ? '1px solid #dc3545'
                  : (retForm.get('mLICID')?.valid && (retForm.get('mLICID')?.dirty || retForm.get('mLICID')?.touched))
                    ? '1px solid #198754'
                    : '',
                'box-shadow': (retForm.get('mLICID')?.invalid && (retForm.get('mLICID')?.dirty || retForm.get('mLICID')?.touched))
                  ? '0 0 0 0.1rem rgba(220,53,69,0.25)'
                  : (retForm.get('mLICID')?.valid && (retForm.get('mLICID')?.dirty || retForm.get('mLICID')?.touched))
                    ? '0 0 0 0.1rem rgba(25,135,84,0.25)'
                    : ''
              }"
              >
            </ng-select>
            <div class="text-danger mt-1">
              <span
                *ngIf="(retForm.get('mLICID')?.touched || submitted) && retForm.get('mLICID')?.errors?.['required']">
                License Type is required.
              </span>
            </div>
            </div>
          </div>
  
       
  
          <!-- Retention Type -->
          <div class="col-md-6 mb-3">
            <label class="form-label fw-bold">Retention Type<span class="text-danger">*</span></label>
            <div class="form-group" style="position: relative;">

            <ng-select class="form-select w-auto" [items]="masRetentionDDL" bindLabel="retname" bindValue="retid"
              formControlName="mretid" [placeholder]="retForm.get('mretid')?.value ? '' : 'Select Retention Type'"
              [searchable]="true" [clearable]="true" appendTo=".form-group"(change)="onRetentionChange($event)" [ngStyle]="{
                'border': (retForm.get('mretid')?.invalid && (retForm.get('mretid')?.dirty || retForm.get('mretid')?.touched))
                  ? '1px solid #dc3545'
                  : (retForm.get('mretid')?.valid && (retForm.get('mretid')?.dirty || retForm.get('mretid')?.touched))
                    ? '1px solid #198754'
                    : '',
                'box-shadow': (retForm.get('mretid')?.invalid && (retForm.get('mretid')?.dirty || retForm.get('mretid')?.touched))
                  ? '0 0 0 0.1rem rgba(220,53,69,0.25)'
                  : (retForm.get('mretid')?.valid && (retForm.get('mretid')?.dirty || retForm.get('mretid')?.touched))
                    ? '0 0 0 0.1rem rgba(25,135,84,0.25)'
                    : ''
              }"
              >
            </ng-select>
            <div class="text-danger mt-1">
              <span
                *ngIf="(retForm.get('mretid')?.touched || submitted) && retForm.get('mretid')?.errors?.['required']">
                Retention Type is required.
              </span>
            </div>
            </div>
          </div>
  
             <!-- Form Type -->
             <div class="col-md-6 mb-3">
              <label class="form-label fw-bold">Form Type<span class="text-danger">*</span></label>
            <div class="form-group" style="position: relative;">

              <ng-select class="form-select w-auto" [items]="filteredFormList" bindLabel="formname" bindValue="formid"
                formControlName="mFormID" [placeholder]="retForm.get('mFormID')?.value ? '' : 'Select Form Type'"
                [searchable]="true" [clearable]="true" appendTo=".form-group" [ngStyle]="{
                  'border': (retForm.get('mFormID')?.invalid && (retForm.get('mFormID')?.dirty || retForm.get('mFormID')?.touched))
                    ? '1px solid #dc3545'
                    : (retForm.get('mFormID')?.valid && (retForm.get('mFormID')?.dirty || retForm.get('mFormID')?.touched))
                      ? '1px solid #198754'
                      : '',
                  'box-shadow': (retForm.get('mFormID')?.invalid && (retForm.get('mFormID')?.dirty || retForm.get('mFormID')?.touched))
                    ? '0 0 0 0.1rem rgba(220,53,69,0.25)'
                    : (retForm.get('mFormID')?.valid && (retForm.get('mFormID')?.dirty || retForm.get('mFormID')?.touched))
                      ? '0 0 0 0.1rem rgba(25,135,84,0.25)'
                      : ''
                }"
                >
              </ng-select>
              <div class="text-danger mt-1">
                <span
                  *ngIf="(retForm.get('mFormID')?.touched || submitted) && retForm.get('mFormID')?.errors?.['required']">
                  Form Type is required.
                </span>
              </div>
              </div>
            </div>
       
  
              <!-- Issue Date -->
      <div class="col-md-6 mb-3">
        <label class="form-label fw-bold">Issue Date<span class="text-danger">*</span></label>
        <input type="date" class="form-control" formControlName="mISSUEDATE"  [ngClass]="{
          'is-invalid': (retForm.get('mISSUEDATE')?.touched || submitted) && retForm.get('mISSUEDATE')?.invalid,
          'is-valid': retForm.get('mISSUEDATE')?.valid && (retForm.get('mISSUEDATE')?.touched || submitted)
        }">
         <span class="text-danger"
         *ngIf="(retForm.get('mISSUEDATE')?.touched || submitted) && retForm.get('mISSUEDATE')?.errors?.['required']">
         Issue Date is required.
       </span>
        <!-- <small class="text-danger" *ngIf="retForm.get('mISSUEDATE')?.touched && retForm.get('mISSUEDATE')?.invalid">
          Issue Date is required.
        </small> -->
      </div>
  
      <!-- Start Date -->
      <div class="col-md-6 mb-3">
        <label class="form-label fw-bold">Start Date<span class="text-danger">*</span></label>
        <input type="date" class="form-control" formControlName="mStartDate" [ngClass]="{
          'is-invalid': (retForm.get('mStartDate')?.touched || submitted) && retForm.get('mStartDate')?.invalid,
          'is-valid': retForm.get('mStartDate')?.valid && (retForm.get('mStartDate')?.touched || submitted)
        }">
         <span class="text-danger"
         *ngIf="(retForm.get('mStartDate')?.touched || submitted) && retForm.get('mStartDate')?.errors?.['required']">
         Start Date is required.
       </span>
           <!-- >
        <small class="text-danger" *ngIf="retForm.get('mStartDate')?.touched && retForm.get('mStartDate')?.invalid">
          Start Date is required.
        </small> -->
      </div>
  
      <!-- Validity Date -->
      <div class="col-md-6 mb-3">
        <label class="form-label fw-bold">Valid Upto<span class="text-danger">*</span></label>
        <input type="date" class="form-control" formControlName="mVALIDITYDATE" [ngClass]="{
          'is-invalid': (retForm.get('mVALIDITYDATE')?.touched || submitted) && retForm.get('mVALIDITYDATE')?.invalid,
          'is-valid': retForm.get('mVALIDITYDATE')?.valid && (retForm.get('mVALIDITYDATE')?.touched || submitted)
        }">
         <span class="text-danger"
         *ngIf="(retForm.get('mVALIDITYDATE')?.touched || submitted) && retForm.get('mVALIDITYDATE')?.errors?.['required']">
         Valid Upto date is required.
       </span>
        <!-- <small class="text-danger" *ngIf="retForm.get('mVALIDITYDATE')?.touched && retForm.get('mVALIDITYDATE')?.invalid">
          Valid Upto date is required.
        </small> -->
      </div>

      <div class="col-md-6 mb-3">
        <label class="form-label fw-bold">Issuing Authority<span class="text-danger">*</span></label>
        <input type="text" class="form-control" formControlName="mProIssuingAuthority"placeholder="Enter Issuing Authority" [ngClass]="{
          'is-invalid': (retForm.get('mProIssuingAuthority')?.touched || submitted) && retForm.get('mProIssuingAuthority')?.invalid,
          'is-valid': retForm.get('mProIssuingAuthority')?.valid && (retForm.get('mProIssuingAuthority')?.touched || submitted)
        }">
         <span class="text-danger"
         *ngIf="(retForm.get('mProIssuingAuthority')?.touched || submitted) && retForm.get('mProIssuingAuthority')?.errors?.['required']">
         Issuing authority is required.
       </span>
        <!-- <small class="text-danger"
          *ngIf="retForm.get('mProIssuingAuthority')?.touched && retForm.get('mProIssuingAuthority')?.invalid">
          issuing authority is required.
        </small> -->
      </div>
  
      <!-- Upload File -->
      <div class="col-md-6 mb-3">
        <label class="form-label fw-bold">Upload File<span class="text-danger">*</span></label>
        <input type="file" class="form-control" accept=".jpg,.jpeg,.png,.pdf" (change)="onFileSelectedRetention($event)" 
        formControlName="Files" [ngClass]="{
          'is-invalid': (retForm.get('Files')?.touched || submitted) && retForm.get('Files')?.invalid,
          'is-valid': retForm.get('Files')?.valid && (retForm.get('Files')?.touched || submitted)
        }" />

<span class="text-danger"
*ngIf="(retForm.get('Files')?.touched || submitted) && retForm.get('Files')?.errors?.['required']">
Please upload the document.
</span>
        <!-- <small class="text-danger" *ngIf="retForm.get('mRETFILE')?.touched && retForm.get('mRETFILE')?.invalid">
          Upload File is required.
        </small> -->
      </div>
  
  
          <!-- Submit -->
          <div class="col-12 text-center mt-3 mb-1 ">
            <button type="submit" class="btn btn-primary px-4" [disabled]="!retForm.valid">
              Save
            </button>
          </div>
        </div>
      </form>
  </div>
  </div>
  </div>
  </div>
  <!-- modal -->
  <div class="modal fade custom-transparent-modal" id="pdfModal" tabindex="-1" aria-labelledby="pdfModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen">
      <div class="modal-content border-0 shadow-none">
        <div class="modal-header bg-dark text-white py-2 px-3">
          <h5 class="modal-title" id="pdfModalLabel">PDF Preview</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-0">
          <iframe
            [src]="sanitizedPdfUrl"
            class="pdf-frame"
            allowfullscreen
          ></iframe>
        </div>
      </div>
    </div>
  </div>