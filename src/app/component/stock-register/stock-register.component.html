<div class="container-fluid py-4">

    <div class="container" style="text-align: center; max-width: 100%; overflow-x: auto;">
      <h1 style="color: rgb(50, 50, 164);"> <strong>Stock Register (Stock Bin Card)</strong></h1>
    </div>
      <div class="row">
        <div class="col-lg-12 col-md-12 table-container mb-4">
            <form [formGroup]="indentForm">
                <div>
                    <mat-form-field class="w-100">
                      <mat-label>Select Item</mat-label>
                      <mat-select formControlName="itemid">
                        <mat-option *ngFor="let item of getReceiptItems" [value]="item.itemid">{{ item.name }}</mat-option>
                      </mat-select>
                      <mat-error *ngIf="indentForm.get('itemid')?.hasError('required') && indentForm.get('itemid')?.touched">
                        Item is required.
                      </mat-error>
                    </mat-form-field>
                  </div>

                <div class="custom-datepicker-container">
                  <mat-form-field class="filter-field w-100" appearance="fill">
                    <mat-label>Date</mat-label>
                    <input matInput [matDatepicker]="picker" placeholder="Choose a date" formControlName="start" [max]="maxDate" >
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                    <mat-error *ngIf="indentForm.get('start')?.hasError('required') && indentForm.get('start')?.touched">
                      Date is required.
                    </mat-error>
                  </mat-form-field>
                </div>
               
                </form>

                <button class="btn btn-outline-primary mb-2" style="display: flex; justify-content: flex-start;"  (click)="show()" >show</button>
                <!-- <button class="btn btn-outline-info mb-2" style="display: flex; justify-content: flex-start;"  (click)="showopeningAndClosing()">show</button> -->
              
          <!-- <div class="text d-flex mt-3 mb-2">
            <button class="btn btn-outline-primary btn-sm" (click)="getAllDispatchPending()" >Drugs</button>
            <button class="btn btn-outline-primary btn-sm" style="margin-left: 3px;" (click)="getAllDispatchPending()">Consumables</button>
          </div> -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="filter-field flex-grow-1">
              <input type="text" class="form-control" placeholder="Filter" (keyup)="applyTextFilter($event)">
            </div>
            <div class="export-menu-container">
              <button mat-button [matMenuTriggerFor]="exportMenu">Export</button>
              <mat-menu #exportMenu="matMenu">
                <button mat-menu-item
                  (click)="exporter.exportTable('xlsx', { fileName: 'stockregister', sheet: 'stockregister', Props: { Author: 'cgmsc' }})">Excel</button>
                <button mat-menu-item (click)="exporter.exportTable('csv')">CSV</button>
                <button mat-menu-item (click)="exporter.exportTable('json')">JSON</button>
                <button mat-menu-item (click)="exporter.exportTable('txt')">TXT</button>
                <button mat-button (click)="exportToPDF()">PDF</button>
    
              </mat-menu>
            </div>
          </div>
    
          <div class="table-responsive">
            <table class="table table-bordeblue  table-striped" mat-table matTableExporter [dataSource]="dataSource" #exporter="matTableExporter" matSort>
    
                     <!-- Serial Number Column -->
              <ng-container matColumnDef="sno">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> S.No </th>
                <td mat-cell *matCellDef="let element"  > {{ element.sno }} </td>
              </ng-container>
    
                  <!-- categoryName Column -->
                  <ng-container matColumnDef="dt">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Date </th>
                    <td mat-cell *matCellDef="let element"  > {{ element.dt }} </td>
                  </ng-container>
    
                  <!-- itemcode Column -->
                  <!-- <ng-container matColumnDef="itemcode">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Code </th>
                    <td mat-cell *matCellDef="let element" (click)="onCodeClick(element.itemid, element.itemcode)"  > {{ element.itemcode }} </td>
                  </ng-container> -->
                  <ng-container matColumnDef="qty">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> QTY </th>
                    <td mat-cell *matCellDef="let element"  >
                        {{ element.qty }}
                    </td>
                  </ng-container>
                  
    
                  <ng-container matColumnDef="typE1">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
                    <td mat-cell *matCellDef="let element"  > {{ element.typE1 }} </td>
                  </ng-container>
                  <!-- itemname Column -->
                  <ng-container matColumnDef="trandate">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Date </th>
                    <td mat-cell *matCellDef="let element"  > {{ element.trandate }} </td>
                  </ng-container>
    
                  <!-- EMD Released Column -->
                  <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Type </th>
                    <td mat-cell *matCellDef="let element" >
                      {{ element.type }}
                    </td>
                  </ng-container>
                  
                  
    
                  <!-- sku Column -->
                  <ng-container matColumnDef="place">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Particular </th>
                    <td mat-cell *matCellDef="let element"  > {{getplace(element.type,element.place)}}  </td>
                  </ng-container>
                  <ng-container matColumnDef="tranno">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Voucher No</th>
                    <td mat-cell *matCellDef="let element"  > {{ element.tranno }} </td>
                  </ng-container>
             
                  <ng-container matColumnDef="opening">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Opening </th>
                    <td mat-cell *matCellDef="let element"  > {{ element.opening }} </td>
                  </ng-container>
                  
                  <!-- Closing Column -->
                  <ng-container matColumnDef="closing">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Closing </th>
                    <td mat-cell *matCellDef="let element"  > {{ element.closing }} </td>
                  </ng-container>
                  <ng-container matColumnDef="ReceivedQTY">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>ReceivedQTY </th>
                    <td mat-cell *matCellDef="let element"  >{{getplaceReceiptQty(element.type,element.qty)}}
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="ConsuptionQTY">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header> ConsuptionQTY </th>
                    <td mat-cell *matCellDef="let element"  > {{getplaceIssue(element.type,element.qty)}} </td>
                  </ng-container>
                  
    
<!-- Modify the header row and data rows to include opening and closing -->
<tr mat-header-row *matHeaderRowDef="['sno','opening','trandate','place','tranno','ReceivedQTY','ConsuptionQTY','closing']"></tr>
<tr  mat-row *matRowDef="let row; columns: ['sno','opening','trandate','place','tranno','ReceivedQTY','ConsuptionQTY','closing'];"></tr>
    
            </table>
          </div>      
          <mat-paginator [pageSizeOptions]="[10, 15, 30]" showFirstLastButtons></mat-paginator>
        </div>
      </div>
    </div>
    